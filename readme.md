
# CIFAR-10 图像分类项目（三层神经网络实现）

## 项目概述
基于 NumPy 实现的三层神经网络，用于 CIFAR-10 数据集的图像分类，包含以下功能模块：
- 数据预处理流水线
- 可调整的神经网络架构
- 超参数调优模块
- 带验证的训练流程
- 测试集完整评估

## 文件结构
```text
.
├── utils.py             # 数据加载/预处理 & 模型保存加载
├── model.py             # 三层神经网络类定义
├── train.py             # 训练循环实现
├── hyper_tuning.py      # 超参数网格搜索
├── test.py              # 模型评估函数
├── main.py              # 主执行脚本
├── hyper_selected.py    # 直接使用最佳超参数训练和测试
└── save_model/          # 模型参数保存目录
```

## 核心功能

### 数据处理
- 规范化的数据分割 (40000/10000/10000)
- 标准化处理（使用训练集统计量）防止数据泄露
- 超参数搜索时：
  - 训练集：40,000 张
  - 验证集：10,000 张
- 最优参数确定后：
  - 训练集：50,000 张（40,000 + 10,000）
  - 测试集：10,000 张

### 模型架构
- 输入层 (3072) → 隐藏层（可配置维度）→ 输出层 (10 类别)
- 激活函数选项：ReLU/Sigmoid
- 参数初始化策略：He/Xavier
- 支持 L2 正则化

### 训练特性
- 小批量梯度下降
- 学习率衰减（每 5 个 epoch 衰减 15%）
- 基于验证准确率的早停机制
- 最佳模型检查点保存

### 超参数搜索
- 网格搜索范围：
  - 隐藏层维度：[32, 64, 128, 256, 512, 1024]
  - 学习率：[0.1, 0.05, 0.01, 0.005, 0.001]
  - L2 正则化强度：[0.1, 0.01, 0.005, 0.0001]
  - 隐藏层激活函数类型：['relu', 'sigmoid']

### 辅助功能
- 自动记录 CSV 训练日志
- 生成训练曲线可视化图表
- 测试评估：
  - 提供 `evaluate_model` 单次评估
  - 完整测试流程 `test_model` 封装

## 环境要求
- Python 3.6+

### 必需依赖库
```bash
numpy
matplotlib
```

## 快速开始

### 准备数据
确保 CIFAR-10 数据位于项目目录的 `cifar-10-batches-py` 文件夹

### 安装依赖
```bash
pip install numpy matplotlib
```

### 运行完整流程
```bash
python main.py
```

### 直接使用最优超参数
```bash
python hyper_selected.py
```

## 输出文件

### 模型存储
- `save_model/` 目录包含：
  - 最佳模型参数 (.npz 文件)
  - 训练曲线图 (.png)

### 训练记录
- `training_log.csv` - 完整的超参数搜索记录

## 输出示例

### 训练阶段输出
```text
Epoch 38/100 => Train loss: 4.8994, Val loss: 4.9164, Val Acc: 0.3935
Epoch 39/100 => Train loss: 4.8634, Val loss: 4.8820, Val Acc: 0.3939
Learning rate decay to 0.0066
Epoch 40/100 => Train loss: 4.8300, Val loss: 4.8489, Val Acc: 0.3926
Epoch 41/100 => Train loss: 4.7985, Val loss: 4.8165, Val Acc: 0.3937
```

### 测试结果
典型最佳超参数配置：
- 隐藏层维度：512
- 初始学习率：0.01
- L2 强度：0.01
- 激活函数：ReLU

最终测试准确率：**0.5410**

## 实现细节

### 数值稳定性
- Softmax 计算时减去最大值防止数值溢出
- 在除法和 log 运算中添加 `eps(1e-8)` 防止除 0 错误

### 正则化策略
- L2 惩罚同时作用于两个全连接层
- 正则化项包含在损失和梯度计算中

### 优化策略
- 每个 epoch 随机打乱数据顺序

## 注意事项
1. **训练时间预估**：
   - 完整超参数搜索：约 240 个组合 × 100 epochs ≈ 48 小时（CPU）
   - 最终模型训练：约 100 epochs ≈ 15 分钟

2. **结果复现性**：
   - 不同随机种子可能导致结果微小差异

3. **文件管理**：
   - 建议定期清理 `save_model/` 目录
   - 训练日志文件可能较大，建议选择性保留

4. **术语说明**：
   - 代码中的 `reg` 和 `l2_lambda` 均表示正则化强度参数
```
